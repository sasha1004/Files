function MM_openBrWindow2(e,t,a,n){window.open(e,t,"Width="+a+",Height="+n+",Left="+Math.ceil(screen.width/2-a/2)+",Scrollbars=1,Top="+Math.ceil(screen.height/2-n/2-7))}function _frm_digits(){(event.keyCode<48||event.keyCode>57)&&(event.returnValue=!1)}function _frm_digits_float(){44!=event.keyCode&&45!=event.keyCode&&46!=event.keyCode&&(event.keyCode<48||event.keyCode>57)&&(event.returnValue=!1)}function showOrHideSectionById(e){var t=document.getElementById(e);t.style.display="none"==t.style.display?"":"none"}function goToURL(e){e&&(parent.document.location.href=e)}function getBasketId(){return $("select[name='switchBasketId']").length>0?$("select[name='switchBasketId']").val():0}function parseBasketsValue(e){return Array.isArray(e)?e.map((e=>parseInt(e,10))).filter((e=>e>=0)):[]}function updateBasketLegend(){var e=$("div.basketLegend"),t=["товар","товара","товаров"];$.ajax({url:"//admin.nodacdn.net/ajax/modules/cart/get.cart.info.php",dataType:"jsonp",data:{clientId,resellerId,basketId:getBasketId(),cookies:document.cookie},type:"GET",success:function(a){(a||"ok"===a.status)&&($(".artCount",e).fadeOut(200,(function(){$(this).html(a.cnt).fadeIn(200)})),$(".moneySumm",e).fadeOut(200,(function(){$(this).html(a.summ).fadeIn(200)})),$(".qty",e).fadeOut(200,(function(){a.qty>0?e.addClass("liveBasketNotEmpty"):e.removeClass("liveBasketNotEmpty"),$(this).html(a.qty).fadeIn(200)})),$(".goodiesText",e).fadeOut(200,(function(){$(this).html(getDeclensionString(a.qty,t)).fadeIn(200)})),$(document).trigger("basketLegendUpdate"))}})}function copyToHiddenField(){var e=$(this).attr("name"),t="checked"==$(this).attr("checked")?1:0;$("input[type=hidden][name="+e+"]").val(t)}function basketSwitcher(){$('select[name="switchBasketId"]').change((function(e){$(this).parents('form[name="switchBasketForm"]').submit()}))}function progressBarLoading(){document.getElementById("progressbar").style.display="block",document.getElementById("darkscreen").style.display="block",document.getElementById("darkscreen_foot").style.display="block",document.getElementById("barText").style.display="block"}function getDeclensionString(e,t=["день","дня","дней"]){let a=Math.abs(e)%100,n=a%10;return a>10&&a<20?t[2]:n>1&&n<5?t[1]:1==n?t[0]:t[2]}function changeSearchStatus(e){"searching"==e?($("#modificationFullNameDiv").html('<span id="carbaseAjaxloader"><span class="fr-loader-horizontal fr-loader-horizontal_sm"><span class="fr-loader-horizontal-dot"></span></span></span>'),$("#carbaseAjaxloader").show()):$("#carbaseAjaxloader").hide()}function initDelivTypeShowForm(){$(".selectDelivAddr").change((function(){var e=$(".shipmentDatesPickup"),t=$(".shipmentDatesDelivery");0==$(this).attr("value")?(showOfficesBlock(),$("input[name='selected_typepay']").prop("title",""),$("input[name='selected_typepay']").prop("disabled",!1),$("input[name='selected_delivtype']").prop("checked",!1),t.length>0&&(t.find("input:checked").prop("checked",!1),e.show(),t.hide())):(showDeliveryTypesBlock(),$("#deliveryOfficesBlock").hide("fast"),t.length>0&&(e.find("input:checked").prop("checked",!1),e.hide(),t.show()))})),$("textarea[name='newdelivaddr']").focus((function(){$("#newaddr").attr("checked","checked"),showDeliveryTypesBlock(),$("#deliveryOfficesBlock").hide("fast")}))}function showDeliveryTypesBlock(){var e=$.data(document.body,"checkedDelivType");$(".noDelivType").css("display","none"),$("input[name='selected_delivtype']").val()?void 0!==e&&$("input[name='selected_delivtype'][value="+e+"]").prop("checked",!0):$(".noDelivType").css("display","block"),$("#deliverytypesblock").show("fast")}function showOfficesBlock(){$("#deliverytypesblock").hide("fast"),$("#deliveryOfficesBlock").show("fast")}jQuery.preloadImages=function(){if("function"==typeof arguments[arguments.length-1])var e=arguments[arguments.length-1];else e=!1;if("object"==typeof arguments[0])var t=(a=arguments[0]).length;else{var a;t=(a=arguments).length-1}for(var n=t,r=0;r<t;r++)jQuery(new Image).attr("src",a[r]).load((function(){--n<1&&"function"==typeof e&&e()}))};var xhr,RequestStatus=function(){var e={};return{setActive:function(t){e[t]=!0},removeActive:function(t){e[t]=null},isActive:function(t){return!!e[t]}}}();function isProductsAlreadyInBasket(e){if(!e)return!1;if(Array.isArray(e))for(var t=0;t<e.length;t++){var a=e[t];if(a&&a.articleExistInBasket)return!0}return!!e.articleExistInBasket}function getAddToBasketConfirmMessage(e,t){if(!Array.isArray(e))return alertMessageAddItemToBasket.replace("xx",e.articlesCount);var a=[],n=$(".js-multiple-basket:first");return e.forEach((function(e){var t=n.find("option[value="+e.basketId+"]").text().trim();a.push(alertMessageAddItemToMultiBasketCnt.replace("XX",'"'+t+'"').replace("YY",e.articlesCount))})),(e.length>1?alertMessageAddItemToMultiBasket:alertMessageAddItemToMultiBasketSingle).replace("XX",a.join(", ")).replace("YY",t)}function prepareAddToBasketWithCheckData(e){var t={checkExistingArticleInCart:!0,number:e.numberFix,brand:e.brand,dataSetKey:e.dataSetKey,distributorRouteId:e.distributorRouteId},a=parseBasketsValue(e.baskets);return a.length&&(t.baskets=a),t}function getProductUniqId(e){return e.brand+"-"+e.number+"-"+e.distributorRouteId}function addToBasketWithCheck(e){var t=getProductUniqId(e);if(!RequestStatus.isActive(t)){RequestStatus.setActive(t);var a=$(e.eventObject),n=a.html();showLoadingIcon(e.eventObject),$.ajax({url:"/?page=addToBasket",dataType:"json",data:prepareAddToBasketWithCheckData(e),type:"POST",success:function(t){if(a.html(n),t){var r={prevContent:n};if(isProductsAlreadyInBasket(t)){var i=$("#dialogConfirm"),o=getAddToBasketConfirmMessage(t,e.quantity);i.html(o).dialog({resizable:!1,modal:!0,maxWidth:400,zIndex:999999,buttons:[{text:answerOptionPositive,click:function(){addToBasket(e,r),i.dialog("close")}},{text:answerOptionNegative,click:function(){a.html(n),i.dialog("close")}}]})}else addToBasket(e,r)}else showTooltip(e.eventObject,{}),showErrorIcon(e.eventObject,n)},error:function(){showTooltip(e.eventObject,{}),showErrorIcon(e.eventObject,n)},complete:function(){RequestStatus.removeActive(t)}})}}function sendGoogleMetricEvent(e){try{googleTrackerId&&pageTracker&&pageTracker._trackPageview(e)}catch(e){}}function prepareAddToBasketData(e){var t={distributorRouteId:e.distributorRouteId,number:e.number,numberFix:e.numberFix,brand:e.brand,quantity:e.quantity,dataSetKey:e.dataSetKey};e.dataSourceId&&(t.dataSourceId=e.dataSourceId),e.searchNumber&&e.searchBrand&&(t.searchNumber=e.searchNumber,t.searchBrand=e.searchBrand),!e.crossSource||e.searchNumber===e.numberFix&&e.searchBrand===e.brand||(t.crossSource=e.crossSource),e.weightFromApi&&(t.weightFromApi=e.weightFromApi),e.usedGroup&&(t.usedGroup=e.usedGroup),e.searchSource&&(t.searchSource=e.searchSource);var a=parseBasketsValue(e.baskets);return a.length&&(t.baskets=a),t}function showSuccessIcon(e,t,a=2e3){var n=$(e);n.html('<span class="fr-icon-checkmark"></span>'),setTimeout((function(){n.html(t)}),a)}function showErrorIcon(e,t,a=2e3){var n=$(e);n.html('<span class="fr-icon-blocked"></span>'),setTimeout((function(){n.html(t)}),a)}function showLoadingIcon(e){$(e).html('<div class="ajaxLoader"></div>')}function showTooltip(e,t=!1){const a=$(e);let n=null;$.fn.qtip.zindex=17e3,a.qtip({overwrite:!0,content:t?getAddToBasketErrorMessage(t):popupMessageAddItemToBasket,position:{my:"bottom left",at:"top center",target:a,viewport:$(window)},style:{classes:"ui-tooltip-green"},hide:{event:"unfocus"},events:{show:function(e,t){n=setTimeout(t.hide,4e3),t.elements.tooltip&&t.elements.tooltip[0]&&(t.elements.tooltip[0].addEventListener("mouseenter",(function(){clearTimeout(n)})),t.elements.tooltip[0].addEventListener("mouseleave",(function(){n=setTimeout(t.hide,4e3)})))},hide:function(e,a){a.destroy(),t&&"error"===t.status&&"nodata"===t.msg&&document.location.reload()}}}).qtip("show")}function getAddToBasketErrorMessage(e){if(e&&"error"===e.status)switch(e.msg){case"auth":return addToCartAuthError;case"nodata":return addToCartDataError;case"limit":return addToCartLimitError;case"limitOneCookie":return addToCartCookieLimitError;case"already_in_cart":return addToCartAlreadyInCartError}return addToCartError}function goToBasket(){if("undefined"!=typeof isVirtualSite&&isVirtualSite){var e="undefined"!=typeof SiteLocale?SiteLocale:"";location.href=e+"/cart/"}else location.href="/?page=trash"}function addToBasket(e,t){sendGoogleMetricEvent("/ajax/addToBasket"),showLoadingIcon(e.eventObject);var a=t.prevContent,n=getProductUniqId(e);RequestStatus.setActive(n),$.ajax({url:"/?page=addToBasket",dataType:"json",data:prepareAddToBasketData(e),type:"POST",success:function(t){t&&"ok"===t.status?(showSuccessIcon(e.eventObject,a),showTooltip(e.eventObject),"go"===e.goToTrash?goToBasket():updateBasketLegend()):(showTooltip(e.eventObject,t||{}),showErrorIcon(e.eventObject,a))},error:function(){showTooltip(e.eventObject,{}),showErrorIcon(e.eventObject,a)},complete:function(){RequestStatus.removeActive(n)}})}function checkPacking(e="#trash_table tr.cart_tr2_trash"){var t=0;return $(e).each((function(e,a){var n=parseInt($(this).find('input[name^="packing"]').val()),r=$(this).find('input[name^="mas_quantity"]'),i=parseInt($(this).find(".positionAvailability").text()),o=$(this).find(".brandNumberText").text(),s=$(r).val();if(0==s&&(s=n,$(r).val(s)),n>1&&(!i||i>=n)&&s%n!=0){var c=packingTrashOrderMessage.replace("{BRAND_NUMBER}",o).replace("{PACKING_VALUES}",n+", "+2*n+", "+3*n);alert(c),t=1}return!0})),1!=t}function checkOnlyOneCheckbox(e){$("input[name='"+e.name+"']:checked").not(e).each((function(){this.checked=!1}))}function htmlspecialchars_decode(e,t){var a=0,n=0,r=!1;void 0===t&&(t=2),e=e.toString().replace(/&lt;/g,"<").replace(/&gt;/g,">");var i={ENT_NOQUOTES:0,ENT_HTML_QUOTE_SINGLE:1,ENT_HTML_QUOTE_DOUBLE:2,ENT_COMPAT:2,ENT_QUOTES:3,ENT_IGNORE:4};if(0===t&&(r=!0),"number"!=typeof t){for(t=[].concat(t),n=0;n<t.length;n++)0===i[t[n]]?r=!0:i[t[n]]&&(a|=i[t[n]]);t=a}return t&i.ENT_HTML_QUOTE_SINGLE&&(e=e.replace(/&#0*39;/g,"'")),r||(e=e.replace(/&quot;/g,'"')),e=e.replace(/&amp;/g,"&")}function correctVin(e){const t={Й:"0",Q:"0",Ц:"W",У:"E",К:"R",Е:"T",Н:"Y",Г:"U",Ш:"1",I:"1",Щ:"0",O:"0",З:"P",Ф:"A",Ы:"S",В:"D",А:"F",П:"G",Р:"H",О:"J",Л:"K",Д:"L",Я:"Z",Ч:"X",С:"C",М:"V",И:"B",Т:"N",Ь:"M"};let a=[...e.toUpperCase()].map((e=>t[e]||e)).join("");return a=a.split(/[\W]/).join(""),a.substr(0,17)}function bindBrandInfoLinkActions(){$(".brandInfoLink").off().on("click",(function(e){return e.preventDefault(),$.fancybox({type:"ajax",href:$(this).data("href"),ajax:{dataType:"jsonp"},helpers:{overlay:{locked:!1}}}),!1}))}function vinOrFrameRadioHandler(e){(e=e||$("body")).find("input[name=vinOrFrame]").on("change",(function(t){var a=e.find("#garageFrame"),n=e.find("#garageVin"),r=$(this);"vin"===r.val()?(a.attr("disabled","disabled").hide(),n.removeAttr("disabled").show()):"frame"===r.val()&&(a.removeAttr("disabled").show(),n.attr("disabled","disabled").hide()),n.next(".validity-field").hide(),a.next(".validity-field").hide()})),e.find("#garageVin").on("keyup change",(function(t){$(this).val(correctVin($.trim($(this).val()))),checkVinWmi(e,$(this))})),e.find("input[name=vinOrFrame]:checked").trigger("change")}function isVinCorrect(e){return null!==e.match(/^[0-9a-hj-npr-z]{13}\d{4}$/i)}function isFrameCorrect(e){return e.length>=1}function checkVinWmi(e,t){let a=e.find("#choiceManufacturers");a.find("option").removeClass("fr-hidden"),t.attr("data-is-auto-select",!1);let n=correctVin($.trim(t.val()));n.length>=2&&(xhr&&4!=xhr.readyState&&xhr.abort(),a.prop("disabled","disabled"),xhr=$.ajax({url:"//admin.nodacdn.net/ajax/modules/vinqu/decode.vin.php?vin="+n,success:function(n){a.prop("disabled",!1);let r=n.brands;if(r&&1===r.length)selectOnlyOneBrandByWmi(e,n.status,r[0],n.bad,t);else if(r.length>1){let t=a.find("option"),n=!0;t.each((function(){let e=$(this);if(-1!==$.inArray(e.text(),r)){if(e.is(":selected")&&""!=e.val())return n=!1,!1}else $(this).addClass("fr-hidden")})),n&&(a.find('option[value=""]').attr("selected","selected").attr("disabled","disabled").removeClass("fr-hidden"),e.find("#carbaseModificationImage").attr("src","//pubimg.4mycar.ru/images/preview/015c5250c6c7f0fb6781fd6efe9f8376de.png"),a.change())}},method:"GET",dataType:"jsonp"}))}function selectOnlyOneBrandByWmi(e,t,a,n,r){let i=e.find("#choiceManufacturers");if(t&&""!==$.trim(a)&&!n){i.find("option").each((function(){let t=$(this);if(t.text()===a&&(r.attr("data-is-auto-select",!0),!t.is(":selected")||""==t.val()))return i.val(t.val()),i.change(),e.find("#carbaseModificationImage").attr("src","//pubimg.4mycar.ru/images/preview/015c5250c6c7f0fb6781fd6efe9f8376de.png"),!1}))}}function extractParamsFromCurrentLocation(){return location.search?exctractParamsFromQueryString(location.search.substring(1)):{}}function exctractParamsFromQueryString(e){if(!e)return{};var t={};return e.split("&").forEach((function(e){var a=e.split("=");t[a[0]]=a[1]})),t}$(document).ready((function(){bindBrandInfoLinkActions(),basketSwitcher(),$(".copyToHidden").each((function(){copyToHiddenField.call(this)})),$(".copyToHidden").click((function(){copyToHiddenField.call(this)})),$(".distributorDescription").unbind("click"),$(".distributorDescription").bind("click",(function(){return $.fancybox({href:this.href,width:500,height:200,type:"ajax",ajax:{dataType:"jsonp"}}),!1})),$(".captchaReload").click((function(){var e=$(".captchaImg").attr("src");return $(".captchaImg").attr("src",e+Math.random()),!1})),$(".brandNameInput").autocomplete({source:function(e,t){$.ajax({url:SiteLocale+"/brandname.json/",dataType:"json",data:{maxResult:12,nameStartsWith:e.term},success:function(e){t($.map(e.brandsData,(function(e){return{label:e.name,value:e.name}})))}})},minLength:2}),$("a.link-button").button(),$(".select-all").each((function(){var e=$(this);e.click((function(){var t=$("."+e.attr("rel"));e.is(":checked")?t.attr("checked","checked"):t.removeAttr("checked")}))})),-1==document.location.href.search("&layout_flipped")||$("#page-search-no-result").size()||$.jGrowl("Раскладка клавиатуры была исправлена, т.к. по исходному запросу ничего не нашлось."),$("#goto-orders-process").click((function(){var e=[];$(".selected-orders:checked").each((function(){e.push($(this).val())})),e=e.join(","),document.location.href="/orders/?process&orders="+e})),$(".jVD").accordion({collapsible:!0,active:!1,autoHeight:!1}),$(".jVDActive").accordion({collapsible:!0,autoHeight:!1}),$(".caseInfo").click((function(e){e&&e.stopPropagation?e.stopPropagation():(e=window.event).cancelBubble=!0})),$("tr.startSearching").on("click",(function(e){if(!($(e.target).hasClass("brandInfoLink")||$(e.target).is("a")||$(e.target).hasClass("searchResultImg")||$(e.target).hasClass("openImageFancyBox"))){var t=$(this).data("link");t&&(window.location=t)}})),$("a.edBlocksImages").fancybox({type:"image",titleShow:!1,centerOnScroll:!0,helpers:{overlay:{locked:!1}},afterLoad:function(){this.element.attr("data-used-article-warning")&&(this.tpl.image='<div class="fancybox-inner" data-used-article-warning="'+$(this.element).data("used-article-warning")+'"><img class="fancybox-image" src="{href}" alt="" /></div>')}}),$(".cartClearButton").click((function(){if(!confirm(confirmCartClear))return!1;$('<input type="hidden" name="cartClear" value="1"/>').insertAfter($(this)),$(this).parents("form").submit()})),$(".bookmark-position").click((function(){var e=$(this),t="add-bookmark-position",a="remove-bookmark-position",n=e.closest("tr").data("positionId");e.hide(),e.after($('<div class="fr-loader-horizontal fr-loader-horizontal_xs fr-text-middle"><div class="fr-loader-horizontal-dot"></div></div>'));var r=e.hasClass(t),i=function(e){return e.closest("td").data("errorMessage")};$.ajax("/?page=orders",{type:"POST",data:{order_pos:n,mark:r},success:function(n){if("1"==n){r?e.removeClass(t).addClass(a):e.removeClass(a).addClass(t);var o=e.data("titleBackup"),s=e.attr("title");e.data("titleBackup",s),e.attr("title",o)}else alert(i(e))},error:function(){alert(i(e))},complete:function(){e.next("div.fr-loader-horizontal").remove(),e.show()}})})),$(".article-image a").fancybox({live:!1,type:"image",padding:0,closeClick:!0,wrapCSS:"articleImageFancybox",helpers:{overlay:{locked:!1}},beforeLoad:function(){},afterLoad:function(){this.element.attr("data-used-article-warning")&&(this.tpl.image='<div class="fancybox-inner" data-used-article-warning="'+$(this.element).data("used-article-warning")+'"><img class="fancybox-image" src="{href}" alt="" /></div>')}}),vinOrFrameRadioHandler(),$("body").on("click","a.extloginBtn",(function(e){MM_openBrWindow2($(this).attr("href"),"socialLogin",695,615),e.preventDefault()}))}));